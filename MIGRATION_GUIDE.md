# Руководство по миграции

## Обзор

Этот документ описывает, как перейти от монолитного `App.js` к новой модульной архитектуре.

## Быстрый старт

### 1. Установка зависимостей

```bash
npm install
```

### 2. Запуск приложения

```bash
npm start
```

Приложение будет доступно по адресу `http://localhost:19006` (или другому порту, указанному в выводе).

## Структура изменений

### Основные файлы

- **`src/index.tsx`** - Новая точка входа (заменяет `index.js`)
- **`src/App.tsx`** - Основной компонент (заменяет `App.js`)
- **`src/state/hooks/useAppState.ts`** - Управление состоянием
- **`src/services/`** - Бизнес-логика и утилиты
- **`src/components/`** - UI компоненты
- **`src/features/`** - Композиционные компоненты

### Файлы стилей

- **`src/styles/tokens.css`** - Дизайн-токены
- **`src/styles/globals.css`** - Глобальные стили
- **`src/styles/components/`** - Стили компонентов

## Миграция данных

### localStorage

Все данные localStorage остались неизменными. Ключи и форматы данных сохранены:

```javascript
// Старые ключи (сохранены)
'supaAuth'
'supaProfiles'
'appTheme'
'financeData'
'cushionHistory'
'investmentHistory'
'debtsHistory'
// ... и другие
```

### Состояние приложения

Все состояния приложения перенесены в `useAppState` хук:

```typescript
// Использование в компонентах
const {
  tab,
  currentUser,
  isDark,
  // ... другие состояния
} = useAppState();
```

## Тестирование

### Запуск тестов

```bash
npm test
```

### Покрытие тестами

```bash
npm run test:coverage
```

### Типы тестов

1. **Unit тесты** - Тестирование отдельных функций
2. **Component тесты** - Тестирование React компонентов
3. **Integration тесты** - Тестирование взаимодействия модулей

## Отладка

### Проверка функциональности

1. **Навигация**: Переключение между вкладками
2. **Финансы**: Добавление транзакций, просмотр графиков
3. **Данные**: Сохранение и загрузка из localStorage
4. **Стили**: Проверка визуального соответствия

### Логирование

```typescript
// Включить детальное логирование
console.log('App state:', useAppState());
```

## Производительность

### Оптимизации

- Компоненты мемоизированы через `React.memo`
- Вычисления оптимизированы через `useMemo`
- Состояние обновляется только при необходимости

### Мониторинг

```typescript
// Проверка перерисовок
const renderCount = useRef(0);
useEffect(() => {
  renderCount.current++;
  console.log(`Component rendered ${renderCount.current} times`);
});
```

## Известные ограничения

### 1. Графики

Графики используют `react-native-chart-kit`, который может иметь ограничения на веб-платформе. Для продакшена рекомендуется:

- Использовать `recharts` или `chart.js` для веба
- Сохранить `react-native-chart-kit` для мобильных платформ

### 2. Уведомления

Уведомления на веб-платформе ограничены. Для полноценной работы:

- Использовать Service Workers
- Интегрировать с Push API
- Добавить fallback на email уведомления

### 3. Файловая система

Некоторые функции (импорт/экспорт файлов) могут работать по-разному на разных платформах.

## Расширение функциональности

### Добавление новых компонентов

1. Создать компонент в `src/components/`
2. Добавить типы в `src/state/types.ts`
3. Добавить состояние в `useAppState`
4. Создать тесты

### Добавление новых утилит

1. Создать файл в `src/services/`
2. Экспортировать из `src/services/index.ts`
3. Добавить тесты

### Добавление новых стилей

1. Создать файл в `src/styles/components/`
2. Импортировать в `src/styles/index.css`
3. Использовать CSS переменные из `tokens.css`

## Обратная связь

### Сообщения об ошибках

При обнаружении проблем:

1. Проверить консоль браузера
2. Запустить тесты
3. Сравнить с оригинальным поведением
4. Создать issue с описанием

### Предложения по улучшению

- Оптимизация производительности
- Улучшение типизации
- Расширение тестового покрытия
- Улучшение документации

## Заключение

Миграция завершена успешно. Новая архитектура обеспечивает:

- ✅ Лучшую поддерживаемость
- ✅ Высокое покрытие тестами
- ✅ Типобезопасность
- ✅ Модульность
- ✅ Производительность

Все функции работают идентично оригиналу, но код стал более структурированным и надежным.
